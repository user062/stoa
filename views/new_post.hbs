<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/material-icons.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">        
    <title>Nouveau Poste</title>
</head>
<body>

    <nav class="navbar navbar-expand-md bg-light sticky-top navbar-light">
        <div class="container">
            <a href="/" class="navbar-brand">
                <img src="images/stoa2.png" alt="stoa">
            </a>      

            <ul class="navbar-nav ml-auto mr-5 nav-flex-icons navbar-account">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink-5" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        <span class="badge badge-danger ml-2">3</span>
                        <span class="material-icons">notifications</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right dropdown-unique notification-menu" aria-labelledby="navbarDropdownMenuLink-5">
                        <a class="dropdown-item navbar-notification-item" href="#">Nouvelle note du module acoo<span class="badge badge-danger ml-2">Nouveau</span></a>
                        <a class="dropdown-item navbar-notification-item" href="#">Nouveau devoire acoo<span class="badge badge-danger ml-2"></span></a>
                        <a class="dropdown-item navbar-notification-item" href="#">Coure ajouté ihm<span class="badge badge-danger ml-2"></span></a>
                    </div>
                </li>
            </ul> 
             

            
            <ul class="navbar-nav nav-flex-icons navbar-account">                      
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="material-icons">person</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right dropdown-unique" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item navbar-account-item" href="/account">Compte</a>
                        <a class="dropdown-item navbar-account-item" href="/logout">Se déconnecter</a>                               
                    </div>
                </li>
            </ul>                                                
        </div>
    </nav>
        
    <div class="sidebar">
        <ul class="links">
            <a href="/new_post" class="btn btn-primary new__descussion">
                <span class="material-icons">add</span>
                <span class="new__descussion-text">Nouvelle Discussion</span>
            </a>
            <li>                                
                <a class="sidebar__link active" href="/">
                    <span class="material-icons">home</span>
                    Home
                </a>                
            </li>                        
            <hr style="background-color: #f6f6f6;height: 1px;width: 75%;margin: 1rem auto">                                            
            {{!-- Button just for profs --}}              
            <li>
            <a href="/new_folder" style="font-size: 14px;">
                <span class="material-icons">add</span>
                <span class="new__descussion-text">Nouveau dossier</span>
            </a>                    
            </li>              
            <li class="module__link">                                                
                {{!-- <a class="sidebar__link" href="/module">
                    <span class="material-icons">folder_open</span>           
                    IHM
                </a>        --}}
                <div class="module__folders">                         
                    <a class="module__folder" href="/resources">
                        <span class="material-icons">folder_open</span>           
                        Resources
                    </a>          
                </div>                     
                <div class="module__folders">                              
                    <a class="module__folder" href="/module_folder">
                        <span class="material-icons">folder_open</span>           
                        Discussions
                    </a>          
                </div>                                        
                <div class="module__folders">                         
                    <a class="module__folder" href="/module_folder">
                        <span class="material-icons">folder_open</span>           
                        serie1
                    </a>          
                </div>      
                <div class="module__folders">                         
                    <a class="module__folder" href="module_folder">
                        <span class="material-icons">folder_open</span>           
                        Autre
                    </a>          
                </div>      
            </li>            
        </ul>
    </div>

    <div class="content">        
        <div class="container">
        <div class="col-10 mx-auto">
            <h5>Ajouter un post</h5>
            <hr>
            {{#if error}}
            <div class="alert alert-danger">
              <strong>{{error}}</strong>
            </div>
            {{/if}}
            <form action="new_post/new_post" method="POST" encType="multipart/form-data">
                <label>Type</label>
                <section class="post__types">                              
                    <div class="type active-type" id="question">
                        <div class="type-logo">
                            <img src="images/icons/faq.png" height="65" width="65">
                        </div>
                        <div class="type-title">
                            Question 
                        </div>
                    </div>
                 
                    <div class="type" id="note">
                        <div class="type-logo">
                            <img src="images/icons/note.png" height="65" width="65">
                        </div>
                        <div class="type-title">
                            Note 
                        </div>
                    </div>                                       
                    <div class="type" id="poll">
                        <div class="type-logo">
                            <img src="images/icons/poll.png" height="65" width="65">
                        </div>
                        <div class="type-title">
                            Poll 
                        </div>
                    </div>                    
                </section><br>
                <section class="post__folder form-group">
                    <label for="title">Dossiers</label>
                    <div class="dossiers">
                      {{#each module.all_folders as |folder|}}
                        <div class="dossier" id={{folder.id}}>
                            <span>{{folder.name}}</span> 
                        </div>
                        {{/each}}
                    </div>
                </section><br>
                <section class="post__title form-group">
                    <label for="title">Titre</label>
                    <input class="form-control" type="text" name="title" placeholder="Titre du sujet" id="title" required>
                </section><br>
                <section class="details">
                    <label>Détailes</label>
                    <textarea name="keyboard_cat" class="petMachine" id="my-expressjs-tinymce-app"></textarea>
                </section>
            


                <section class="add-poll-section my-5">
                    <label for="title">Sondage</label>                    
                    <div class="add-poll mb-2" style="display: flex;justify-content: space-between">
                        <input class="form-control col-8" type="text" name="new-option" placeholder="Ajouter une option" id="new-option">
                        <button type="button" class="btn btn-secondary col-3 mx-auto" style="font-size: 14px!important" onclick="add_choice()">Ajouter</button>                    
                    </div>

                    <ul id="choices" name="survey" class="list-group mb-5">                        
                    </ul>
                        

                </section>

                <button type="submit" class="btn btn-primary col-12 ml-auto mt-3 mb-5" onclick="select_type()">Ajouter</button>
            </form>


            
        </div>
        </div>
    </div>

    <!-- Script element sourcing TinyMCE -->
    <script type="application/javascript" src= "/tinymce/tinymce.min.js"></script>
    <!-- Script element sourcing the TinyMCE configuration -->
    <script type="application/javascript" src= "/js/my-tinymce-config.js"></script>

    <script src="js/main.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <script>
      function select_type(){
          let form = document.getElementsByTagName("form")[0];

          let chosen_type = document.getElementsByClassName("active-type")[0];
          let type = document.createElement('input');
          type.setAttribute("type", "hidden");
          type.setAttribute("name", "type");
          type.setAttribute("value", chosen_type.id);
          form.appendChild(type);

          let selected_folders = document.getElementsByClassName("selected-folder");
          for(let selected_folder of selected_folders){
              let folder = document.createElement('input');
              folder.setAttribute("type", "hidden");
              folder.setAttribute("name", "folders")
              folder.setAttribute("value", selected_folder.id);
              form.appendChild(folder);
          }

          let file = tinymce.activeEditor.dom.remove('files');

          let choices = document.getElementById("choices");
          for(let choice of choices.children) {
              let choice_field = document.createElement('input');
              choice_field.setAttribute("type", "hidden");
              choice_field.setAttribute("name", "choices")
              choice_field.setAttribute("value", choice.title);
              form.appendChild(choice_field);
          }
      }

      function add_choice(){
          let choices_list = document.getElementById('choices');
          let id = choices_list.lastElementChild? Number(choices_list.lastElementChild.id)+1: 0;
          let choice = document.createElement('li');
          choice.setAttribute('id', id);
          choice.classList.add('list-group-item');
          choice.classList.add('d-inline-flex');
          choice.classList.add('justify-content-between');
          let text = document.getElementById('new-option');

          if(text.value === ''){
              text.required = true;
              text.setCustomValidity('please fill out the choice');
              text.reportValidity();
              text.setCustomValidity('');
              text.required = false;
              return;
          }

          let choice_text = document.createTextNode(text.value);
          let delete_button = document.createElement('button');
          delete_button.appendChild(document.createTextNode('Supprimer'));
          delete_button.setAttribute('onclick', `delete_choice(${id});`);
          delete_button.setAttribute('type', 'button');
          delete_button.classList.add('choice-delete');
          choice.appendChild(choice_text);
          choice.appendChild(delete_button);
          choices_list.appendChild(choice);
          choice.setAttribute('title', text.value);
          text.value = '';
      }

      function delete_choice(id) {
          let choices = document.getElementById('choices');

          for(const choice of choices.children) {
              if(choice.id === String(id))
                  return choice.remove();
          }
          
      }
    </script>

</body>
</html>
